<!DOCTYPE html>

<html>

<head>
    <title>APL Configurator Editor</title>
    <link href="css/jsoneditor.css" rel="stylesheet" type="text/css">
    <script src="js/jsoneditor.js"></script>
    <script src="https://bgrins.github.io/filereader.js/filereader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js"></script>
</head>

<body>
    <button id="saveDocument" value="Save">Save</button>
    <div id="jsoneditor" style="width: 100%; height: 100%;"></div>

    <script>
        fetch('../texts_new.json')
            .then(response => response.json())
            .then(questions => {

                var container = document.getElementById("jsoneditor");
                var schema = {
                    "$schema": "http://json-schema.org/draft-04/schema#",
                    "title": "Questions",
                    "description": "APL-Configurator questions",
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "isoCode": {
                                "description": "Language iso code",
                                "type": "string",
                                "minLength": 2,
                                "maxLength": 2
                            },
                            "questions": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "isoCode": {
                                            "description": "Language iso code",
                                            "type": "string",
                                            "minLength": 2,
                                            "maxLength": 2
                                        },
                                        "questions": {
                                            "description": "Questions contents",
                                            "type": "object",
                                            "properties": {
                                                "id": {
                                                    "description": "The unique identifier for a question",
                                                    "type": "integer"
                                                },
                                                "text": {
                                                    "description": "Question's text",
                                                    "type": "string"
                                                },
                                                "images": {
                                                    "description": "Question's images",
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string"
                                                    },
                                                    "minItems": 1,
                                                    "uniqueItems": true
                                                },
                                                "options": {
                                                    "description": "Question's possible answers",
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string"
                                                    },
                                                    "minItems": 2,
                                                    "uniqueItems": true
                                                }
                                            },
                                            "required": [
                                                "id",
                                                "text",
                                                "options"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "isoCode",
                                        "questions"
                                    ]
                                }
                            }
                        }
                    }
                };

                var options = {
                    mode: 'form',
                    history: true,
                    search: true
                    //schema: schema
                };


                var editor = new JSONEditor(container, options);

                editor.set(questions);

                // Save a JSON document
                document.getElementById('saveDocument').onclick = function () {
                    // Save Dialog
                    fname = 'texts_new.json';

                    // Check json extension in file name
                    if (fname.indexOf(".") == -1) {
                        fname = fname + ".json";
                    } else {
                        if (fname.split('.').pop().toLowerCase() == "json") {
                            // Nothing to do
                        } else {
                            fname = fname.split('.')[0] + ".json";
                        }
                    }
                    var blob = new Blob([editor.getText()], { type: 'application/json;charset=utf-8' });
                    saveAs(blob, fname);
                };
            });
    </script>
</body>

</html>